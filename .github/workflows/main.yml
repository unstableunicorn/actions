name: main

on:
  push:
    paths-ignore:
      - ".gitignore"
      - "LICENSE"
      - "README.md"
    branches:
      - "main"

jobs:
  changes:
    runs-on: ubuntu-latest
    outputs:
      srcout: ${{ steps.filter.outputs.src }}
      filters: ${{ steps.filter.outputs.changes }}
      files: ${{ steps.filter.outputs.src_files }}
    steps:
    - uses: actions/checkout@v3
    - uses: dorny/paths-filter@v2
      id: filter
      with:
        list-files: 'json'
        filters: |
          src:
            - src/**

  basic:
    needs: changes
    if: ${{ needs.changes.outputs.srcout == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: "changed filters"
        run: echo "${{ needs.changes.outputs.filters }}"

      - name: "changed files"
        run: echo "${{ needs.changes.outputs.files }}"

      - name: "child one"
        if: ${{ contains(${{ needs.changes.outputs.files }}, "src/children/one") }}
        run: echo "i modified child one"

      - name: "child two" 
        if: ${{ contains(fromJson(${{ needs.changes.outputs.files }}), "src/children/two") }}
        run: echo "i modified child two"
      
      - name: "children"
        if: ${{ contains(${{ needs.changes.outputs.files }}, "src/children") }}
        run: echo "i modified my children"

      - name: "only child"
        if: ${{ contains(${{ needs.changes.outputs.files }}, "src/onlychild") }}
        run: echo "i modified my only child"
  
  child:
    uses: ./.github/workflows/child1.yml
